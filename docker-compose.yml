version: '3.8'

services:
  stt-server:
    build:
      context: ./services/stt-server
      dockerfile: Dockerfile
    container_name: eburon-stt
    ports:
      - "8001:8001"
    environment:
      - STT_MODEL_SIZE=large-v3
      - STT_DEVICE=cpu
      - STT_COMPUTE_TYPE=int8
    volumes:
      - whisper-cache:/root/.cache/huggingface
    restart: unless-stopped

  tts-server:
    build:
      context: ./services/tts-server
      dockerfile: Dockerfile
    container_name: eburon-tts
    ports:
      - "8002:8002"
    environment:
      - TTS_DEFAULT_ENGINE=kokoro
      - HF_TOKEN=${HF_TOKEN}
    volumes:
      - ./services/tts-server/voices:/app/voices
      - tts-cache:/root/.cache
    restart: unless-stopped

  # NOTE: Requires NVIDIA GPU - disabled on Mac
  insanely-fast-whisper:
    image: registry.hf.space/gobeldan-insanely-fast-whisper-webui:latest
    container_name: eburon-fast-whisper
    platform: linux/amd64
    command: python app.py
    ports:
      - "8003:7860"
    volumes:
      - whisper-cache:/root/.cache/huggingface
    restart: unless-stopped

  gemini-proxy:
    build:
      context: ./services/gemini-proxy
      dockerfile: Dockerfile
    container_name: eburon-gemini
    ports:
      - "8004:8004"
    environment:
      - GEMINI_API_KEY=${GEMINI_API_KEY}
    restart: unless-stopped

volumes:
  whisper-cache:
  tts-cache:
